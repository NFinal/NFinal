#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace NFinal.Compile.Template.Startup
{
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text;
    
    [System.CodeDom.Compiler.GeneratedCodeAttribute("RazorGenerator", "2.0.0.0")]
    public partial class OwinRouter : RazorGenerator.Templating.RazorTemplateBase
    {
#line hidden
        #line 3 "..\..\Template\Startup\OwinRouter.cshtml"
           
    public Compile.Template.Startup.OwinRouterModel Model { get; set; }

        #line default
        #line hidden
        
        public override void Execute()
        {
WriteLiteral("\r\n");

WriteLiteral(@"﻿﻿//======================================================================
//
//        Copyright : Zhengzhou Strawberry Computer Technology Co.,LTD.
//        All rights reserved
//        
//        Application:NFinal MVC framework
//        Filename :Router.cs
//        Description :路由类
//
//        created by Lucas at  2015-10-15`
//     
//        WebSite:http://www.nfinal.com
//
//======================================================================
using System;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Text.RegularExpressions;
using NFinal;

namespace ");

            
            #line 26 "..\..\Template\Startup\OwinRouter.cshtml"
            
            
            #line default
            #line hidden
            
            #line 26 "..\..\Template\Startup\OwinRouter.cshtml"
       Write(Model.project);

            
            #line default
            #line hidden
            
            #line 26 "..\..\Template\Startup\OwinRouter.cshtml"
                          
            
            #line default
            #line hidden
WriteLiteral(@"
{
#if (!AspNET && !NFinalOwin)
    public static class OwinRouter
    {
        /// <summary>  
        /// 本地时间转成GMT时间  
        /// </summary>  
        public static string ToGmtString(DateTime dt)
        {
            return dt.ToUniversalTime().ToString(""r"");
        }
        /// <summary>  
        /// 本地时间转成GMT格式的时间  
        /// </summary>  
        public static string ToGmtFormat(DateTime dt)
        {
            return dt.ToString(""r"") + dt.ToString(""zzz"").Replace("":"", """");
        }
        /// <summary>  
        /// GMT时间转成本地时间  
        /// </summary>  
        /// <param");

WriteLiteral(" name=\"gmt\"");

WriteLiteral(">字符串形式的GMT时间</param>  \r\n        /// <returns></returns>  \r\n        public static " +
"DateTime Gmt2Local(string gmt)\r\n        {\r\n            DateTime dt = DateTime.Mi" +
"nValue;\r\n            try\r\n            {\r\n                string pattern = \"\";\r\n " +
"               if (gmt.IndexOf(\"+0\") != -1)\r\n                {\r\n                " +
"    gmt = gmt.Replace(\"GMT\", \"\");\r\n                    pattern = \"ddd, dd MMM yy" +
"yy HH\':\'mm\':\'ss zzz\";\r\n                }\r\n                if (gmt.ToUpper().Inde" +
"xOf(\"GMT\") != -1)\r\n                {\r\n                    pattern = \"ddd, dd MMM" +
" yyyy HH\':\'mm\':\'ss \'GMT\'\";\r\n                }\r\n                if (pattern != \"\"" +
")\r\n                {\r\n                    dt = DateTime.ParseExact(gmt, pattern," +
" System.Globalization.CultureInfo.InvariantCulture, System.Globalization.DateTim" +
"eStyles.AdjustToUniversal);\r\n                    dt = dt.ToLocalTime();\r\n       " +
"         }\r\n                else\r\n                {\r\n                    dt = Co" +
"nvert.ToDateTime(gmt);\r\n                }\r\n            }\r\n            catch\r\n   " +
"         {\r\n            }\r\n            return dt;\r\n        }\r\n        private st" +
"atic void Callback(IAsyncResult result)\r\n        {\r\n            //结束异步写入\r\n      " +
"      System.IO.FileStream stream = (System.IO.FileStream)result.AsyncState;\r\n  " +
"          stream.EndWrite(result);\r\n            stream.Dispose();\r\n        }\r\n\t\t" +
"//设置浏览器缓存\r\n        public static void SetBrowerCache(Microsoft.Owin.IOwinContext" +
" context, int optimizing,int seconds)\r\n        {\r\n            //浏览器缓存\r\n         " +
"   if ((optimizing & (int)NFinal.Optimizing.Cache_Brower_Cached) != 0)\r\n        " +
"    {\r\n                context.Response.Headers.Set(\"Cache-Control\", \"public\");\r" +
"\n                context.Response.Headers.Set(\"Date\",ToGmtString(DateTime.Now));" +
"\r\n                //NotModify\r\n                if ((optimizing & (int)NFinal.Opt" +
"imizing.Cache_Browse_NotModify) != 0)\r\n                {\r\n                    st" +
"ring filename = System.IO.Path.Combine(AppDomain.CurrentDomain.SetupInformation." +
"ApplicationBase, context.Request.PathBase.Value, context.Request.Path.Value);\r\n " +
"                   if (System.IO.File.Exists(filename))\r\n                    {\r\n" +
"                        System.IO.FileInfo fileInfo = new System.IO.FileInfo(fil" +
"ename);\r\n                        string lastModified = ToGmtString(fileInfo.Last" +
"WriteTime);\r\n                        context.Response.Headers.Set(\"Last-Modified" +
"\", lastModified);\r\n                    }\r\n                    else\r\n            " +
"        {\r\n                        context.Response.Headers.Set(\"Last-Modified\"," +
" ToGmtString(DateTime.Now));\r\n                    }\r\n                }\r\n        " +
"        //Expires\r\n                else if ((optimizing & (int)NFinal.Optimizing" +
".Cache_Browser_Expires) != 0)\r\n                {\r\n                    context.Re" +
"sponse.Headers.Set(\"Expires\", ToGmtString(DateTime.Now.AddSeconds(seconds)));\r\n " +
"               }\r\n                //NoExpires\r\n                else if ((optimiz" +
"ing & (int)NFinal.Optimizing.Cache_Browser_NoExpires) != 0)\r\n                {\r\n" +
"                }\r\n            }\r\n            else\r\n            {\r\n             " +
"   //不进行缓存\r\n                context.Response.Headers.Set(\"Cache-Control\",\"privat" +
"e\");\r\n            }\r\n        }\r\n        //设置服务器缓存\r\n        public static void Se" +
"tServerCacheAndOutPut(Microsoft.Owin.IOwinContext context,string url, string que" +
"ry, byte[] buffer, int optimizing, int seconds)\r\n        {\r\n            //服务器缓存\r" +
"\n            if ((optimizing & (int)NFinal.Optimizing.Cache_Server_Cached) != 0)" +
"\r\n            {\r\n                //FileDependency\r\n                if ((optimizi" +
"ng & (int)NFinal.Optimizing.Cache_Server_FileDependency) != 0)\r\n                " +
"{\r\n                    string fileName=null;\r\n\t\t\t\t\tif(url.EndsWith(\"/\"))\r\n\t\t\t\t\t{" +
"\r\n\t\t\t\t\t\tfileName = NFinal.Utility.MapPath(url+\"Index.html\");\r\n\t\t\t\t\t}\r\n          " +
"          else\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfileName = NFinal.Utility.MapPath(url);\r\n\t\t\t\t\t}\r\n\t" +
"\t\t\t\tif ((optimizing & (int)NFinal.Optimizing.CompressZip) != 0)\r\n               " +
"     {\r\n                        fileName = fileName + \".zip\";\r\n                 " +
"   }\r\n                    else if ((optimizing & (int)NFinal.Optimizing.Compress" +
"Deflate) != 0)\r\n                    {\r\n                        fileName = fileNa" +
"me + \".deflate\";\r\n                    }\r\n                    //将HTML写入静态文件\r\n    " +
"                if (!System.IO.File.Exists(fileName))\r\n                    {\r\n\t\t" +
"\t\t\t\tstring dir = System.IO.Path.GetDirectoryName(fileName);\r\n                   " +
"     if (!System.IO.Directory.Exists(dir))\r\n                        {\r\n         " +
"                   System.IO.Directory.CreateDirectory(dir);\r\n                  " +
"      }\r\n                        System.IO.FileStream file = new System.IO.FileS" +
"tream(fileName, System.IO.FileMode.Create, System.IO.FileAccess.Write, System.IO" +
".FileShare.ReadWrite, 1024, true);\r\n                        file.BeginWrite(buff" +
"er, 0, buffer.Length, new AsyncCallback(Callback), file);\r\n                    }" +
"\r\n\t\t\t\t\tif (seconds > 0)\r\n                    {\r\n\t\t\t\t\t\t//将HTML插入新的缓存\r\n\t\t\t\t\t\tSyste" +
"m.Runtime.Caching.CacheItemPolicy itemPolicy = new System.Runtime.Caching.CacheI" +
"temPolicy();\r\n\t\t\t\t\t\titemPolicy.ChangeMonitors.Add(new System.Runtime.Caching.Hos" +
"tFileChangeMonitor(new string []{fileName }));\r\n\t\t\t\t\t\tSystem.Runtime.Caching.Mem" +
"oryCache.Default.Set(new System.Runtime.Caching.CacheItem(url+query,buffer),item" +
"Policy);\r\n\t\t\t\t\t}\r\n                }\r\n                //AbsoluteExpiration\r\n     " +
"           else if ((optimizing & (int)NFinal.Optimizing.Cache_Server_AbsoluteEx" +
"piration) != 0)\r\n                {\r\n                    System.Runtime.Caching.C" +
"acheItemPolicy itemPolicy = new System.Runtime.Caching.CacheItemPolicy();\r\n     " +
"               itemPolicy.AbsoluteExpiration=DateTimeOffset.Now.AddSeconds(secon" +
"ds);\r\n                    System.Runtime.Caching.MemoryCache.Default.Set(new Sys" +
"tem.Runtime.Caching.CacheItem(url+query, buffer), itemPolicy);\r\n                " +
"}\r\n                //SlidingExpiration\r\n                else if ((optimizing & (" +
"int)NFinal.Optimizing.Cache_Server_SlidingExpiration) != 0)\r\n                {\r\n" +
"                    System.Runtime.Caching.CacheItemPolicy itemPolicy = new Syst" +
"em.Runtime.Caching.CacheItemPolicy();\r\n                    itemPolicy.SlidingExp" +
"iration=new TimeSpan(0, 0, seconds);\r\n                    System.Runtime.Caching" +
".MemoryCache.Default.Set(new System.Runtime.Caching.CacheItem(url+query,buffer)," +
"itemPolicy);\r\n                }\r\n            }\r\n            //直接输出\r\n            " +
"context.Response.Body.Write(buffer, 0, buffer.Length);\r\n            context.Resp" +
"onse.Body.Dispose();\r\n        }\r\n        //写入缓存\r\n        public static bool Writ" +
"eCache(Microsoft.Owin.IOwinContext context,string url,int optimizing)\r\n        {" +
"\r\n            //服务器缓存\r\n            if ((optimizing & (int)NFinal.Optimizing.Cach" +
"e_Server_Cached) != 0)\r\n            {\r\n                object cache = System.Run" +
"time.Caching.MemoryCache.Default.Get(url);\r\n                //如果缓存存在则直接输出.\r\n    " +
"            if (cache != null)\r\n                {\r\n                    if ((opti" +
"mizing & (int)NFinal.Optimizing.Comresssed) != 0)\r\n                    {\r\n      " +
"                  if ((optimizing & (int)NFinal.Optimizing.CompressZip) != 0)\r\n " +
"                       {\r\n                            context.Response.Headers.A" +
"ppend(\"Content-encoding\", \"gzip\");\r\n                        }\r\n                 " +
"       else if ((optimizing & (int)NFinal.Optimizing.CompressDeflate) != 0)\r\n   " +
"                     {\r\n                            context.Response.Headers.App" +
"end(\"Content-encoding\", \"deflate\");\r\n                        }\r\n                " +
"    }\r\n                    byte[] buffer= (byte[])cache;\r\n                    co" +
"ntext.Response.Body.Write(buffer, 0, buffer.Length);\r\n                    contex" +
"t.Response.Body.Dispose();\r\n                    return true;\r\n                }\r" +
"\n            }\r\n            return false;\r\n        }\r\n        /// <summary>\r\n   " +
"     /// 计算actionUrl\r\n        /// </summary>\r\n        /// <param");

WriteLiteral(" name=\"requestedPath\"");

WriteLiteral("></param>\r\n        /// <returns></returns>\r\n        private static string GetActi" +
"onUrl(string requestedPath)\r\n        {\r\n            int position = requestedPath" +
".LastIndexOf(\'.\');\r\n            string actionUrl = \"\";\r\n            if (position" +
" > 0)\r\n            {\r\n\t\t\t\tint pointer = 0;\r\n                bool hasGet = int.Tr" +
"yParse(requestedPath.Substring(position - 2, 2), out pointer);\r\n                " +
"if (hasGet)\r\n                {\r\n                    actionUrl = requestedPath.Su" +
"bstring(0, pointer + 1);\r\n                }\r\n                else\r\n             " +
"   {\r\n                    actionUrl = requestedPath;\r\n                }\r\n       " +
"     }\r\n            return actionUrl;\r\n        }\r\n        public static void Run" +
"(Microsoft.Owin.IOwinContext context,string rootDir, string requestedPath,int ac" +
"tionId)\r\n        {\r\n            //提取域名参数\r\n            string host= context.Reque" +
"st.Host.Value;\r\n            string[] hostName = host.Split(\'.\');\r\n            st" +
"ring subdomain = hostName.Length == 3 ? hostName[0] : \"www\";\r\n            NFinal" +
".NameValueCollection get = new NFinal.NameValueCollection();\r\n\t\t\t//提取MethodType\r" +
"\n            NFinal.MethodType methodType = NFinal.MethodType.NONE;\r\n           " +
" switch (context.Request.Method)\r\n            {\r\n                case \"POST\": me" +
"thodType = NFinal.MethodType.POST; break;\r\n                case \"GET\": methodTyp" +
"e = NFinal.MethodType.GET; break;\r\n                case \"DELETE\": methodType = N" +
"Final.MethodType.DELETE; break;\r\n                case \"PUT\": methodType = NFinal" +
".MethodType.PUT; break;\r\n                case \"AJAX\": methodType = NFinal.Method" +
"Type.AJAX; break;\r\n                default: methodType = NFinal.MethodType.NONE;" +
" break;\r\n            }\r\n            //提取内容类型\r\n\t\t\tDictionary<string,NFinal.HttpFi" +
"le> files = null;\r\n\t\t\tif (methodType == NFinal.MethodType.POST)\r\n\t\t\t{\r\n\t\t\t\tNFina" +
"l.ContentType contentType = NFinal.ContentType.NONE;\r\n\t\t\t\tswitch (context.Reques" +
"t.ContentType.Split(\';\')[0])\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"multipart/form-data\":contentType" +
" = NFinal.ContentType.Multipart_form_data; break;\r\n                    case \"tex" +
"t/json\":\r\n\t\t\t\t\tcase \"application/json\":contentType = NFinal.ContentType.Applicat" +
"ion_json; break;\r\n\t\t\t\t\tcase \"application/x-www-form-urlencoded\":contentType = NF" +
"inal.ContentType.Application_x_www_form_urlencoded; break;\r\n                    " +
"case \"application/xml\":\r\n                    case \"text/xml\":contentType = NFina" +
"l.ContentType.Text_xml; break;\r\n\t\t\t\t\tcase \"application/octet-stream\":contentType" +
" = NFinal.ContentType.Application_octet_stream;break;\r\n\t\t\t\t\tdefault:contentType " +
"= NFinal.ContentType.NONE; break;\r\n\t\t\t\t}\r\n\t\t\t\t//提取form参数\r\n\t\t\t\tif (context.Reques" +
"t.Body!=System.IO.Stream.Null)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (contentType == NFinal.ContentTyp" +
"e.Application_x_www_form_urlencoded)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tSystem.IO.StreamReader sr = " +
"new System.IO.StreamReader(context.Request.Body);\r\n\t\t\t\t\t\tstring body = sr.ReadTo" +
"End();\r\n\t\t\t\t\t\tsr.Dispose();\r\n\t\t\t\t\t\tif (!string.IsNullOrEmpty(body))\r\n\t\t\t\t\t\t{\r\n\t\t" +
"\t\t\t\t\tstring[] formArray = body.Split(\'&\', \'=\');\r\n\t\t\t\t\t\t\tif (formArray.Length > 1" +
" && (formArray.Length & 1) == 0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfor (int i = 0; i < formArra" +
"y.Length; i");

WriteLiteral(" +=");

WriteLiteral(" 2)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tget.Add(formArray[i], NFinal.Utility.UrlDecode(formArray" +
"[i + 1]));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (contentType == N" +
"Final.ContentType.Text_xml)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tSystem.IO.StreamReader sr = new Syste" +
"m.IO.StreamReader(context.Request.Body);\r\n\t\t\t\t\t\tstring body = sr.ReadToEnd();\r\n\t" +
"\t\t\t\t\tsr.Dispose();\r\n\t\t\t\t\t\tif (!string.IsNullOrEmpty(body))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tSyst" +
"em.Xml.XmlDocument doc = new System.Xml.XmlDocument();\r\n\t\t\t\t\t\t\tdoc.LoadXml(body)" +
";\r\n\t\t\t\t\t\t\tif (doc.DocumentElement != null)\r\n\t\t\t\t\t\t    {\r\n\t\t\t\t\t\t        foreach (" +
"System.Xml.XmlElement xmlNode in doc.DocumentElement.ChildNodes)\r\n\t\t\t\t\t\t        " +
"{\r\n\t\t\t\t\t\t            get.Add(xmlNode.Name, xmlNode.Value);\r\n\t\t\t\t\t\t        }\r\n\t\t\t" +
"\t\t\t    }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (contentType == NFinal.ContentType.Appli" +
"cation_json)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tSystem.IO.StreamReader sr = new System.IO.StreamRead" +
"er(context.Request.Body);\r\n\t\t\t\t\t\tstring body = sr.ReadToEnd();\r\n\t\t\t\t\t\tsr.Dispose" +
"();\r\n                        IDictionary<string,object> data= SimpleJson.Deseria" +
"lizeObject <IDictionary<string, object>>(body);\r\n                        foreach" +
" (var ele in data)\r\n                        {\r\n                            get.A" +
"dd(ele.Key, ele.Value.ToString());\r\n                        }\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse" +
" if (contentType == NFinal.ContentType.Multipart_form_data)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t//mul" +
"tipart/form-data\r\n\t\t\t\t\t\tstring boundary =NFinal.HttpMultipart.boundaryReg.Match(" +
"context.Request.ContentType).Value;\r\n\t\t\t\t\t\tfiles = new Dictionary<string, NFinal" +
".HttpFile>();\r\n\t\t\t\t\t\tvar multipart = new NFinal.HttpMultipart(context.Request.Bo" +
"dy, boundary);\r\n\t\t\t\t\t\tforeach (var httpMultipartBoundary in multipart.GetBoundar" +
"ies())\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (string.IsNullOrEmpty(httpMultipartBoundary.Filename)" +
")\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tstring name = httpMultipartBoundary.Name;\r\n\t\t\t\t\t\t\t\tif (!str" +
"ing.IsNullOrEmpty(name))\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tstring value = new System.IO.Strea" +
"mReader(httpMultipartBoundary.Value).ReadToEnd();\r\n\t\t\t\t\t\t\t\t\tget.Add(name, value)" +
";\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tfiles.Add(httpMultipartBo" +
"undary.Name,new NFinal.HttpFile(httpMultipartBoundary));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t" +
"\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//提取URL?后的参数\r\n\t\t\tif (context.Request.QueryString.HasValue)\r" +
"\n            {\r\n                string[] queryArray = context.Request.QueryStrin" +
"g.Value.Split(\'&\');\r\n                string[] queryKeyValue = null;\r\n           " +
"     for (int i = 0; i < queryArray.Length; i++)\r\n                {\r\n           " +
"         queryKeyValue = queryArray[i].Split(\'=\');\r\n                    if (quer" +
"yKeyValue.Length > 1)\r\n                    {\r\n                        get.Add(qu" +
"eryKeyValue[0],NFinal.Utility.UrlDecode(queryKeyValue[1]));\r\n                   " +
" }\r\n                }\r\n            }\r\n            //获取actionUrl,用于获取参数\r\n\t\t\tswitc" +
"h (actionId)\r\n            {\r\n");

            
            #line 368 "..\..\Template\Startup\OwinRouter.cshtml"
				
            
            #line default
            #line hidden
            
            #line 368 "..\..\Template\Startup\OwinRouter.cshtml"
      int i=1,j=1;
				foreach(var fileData in Model.controllerFileDataList){
				var config=fileData.config;
                foreach(var classData in fileData.ClassDataList){
				foreach(var method in classData.MethodDataList){
					if(method.isPublic){

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t");

WriteLiteral("case ");

            
            #line 374 "..\..\Template\Startup\OwinRouter.cshtml"
       Write(i);

            
            #line default
            #line hidden
WriteLiteral(":\r\n");

WriteLiteral("\t\t\t\t\t");

WriteLiteral("{\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("context.Response.ContentType = \"");

            
            #line 376 "..\..\Template\Startup\OwinRouter.cshtml"
                                   Write(method.contentType);

            
            #line default
            #line hidden
WriteLiteral("\";\r\n");

            
            #line 377 "..\..\Template\Startup\OwinRouter.cshtml"
						if(!method.urlParser.hasNoParamsInUrl){

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t\t\t");

WriteLiteral("Regex regParameters = new Regex(\"");

            
            #line 378 "..\..\Template\Startup\OwinRouter.cshtml"
                                     Write(method.urlParser.parameterRegex);

            
            #line default
            #line hidden
WriteLiteral("\");\r\n");

WriteLiteral("\t\t\t\t\t\t\t");

WriteLiteral("Match matParameters = regParameters.Match(requestedPath);\r\n");

            
            #line 380 "..\..\Template\Startup\OwinRouter.cshtml"
							j=1;
							foreach(var parameterData in method.parameterDataList){
							if(parameterData.isUrlParameter){

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t\t\t");

WriteLiteral("get.Add(\"");

            
            #line 383 "..\..\Template\Startup\OwinRouter.cshtml"
             Write(parameterData.name);

            
            #line default
            #line hidden
WriteLiteral("\", matParameters.Groups[");

            
            #line 383 "..\..\Template\Startup\OwinRouter.cshtml"
                                                        Write(j);

            
            #line default
            #line hidden
WriteLiteral("].Value);\r\n");

            
            #line 384 "..\..\Template\Startup\OwinRouter.cshtml"
							j++;
							}}}
						
            
            #line default
            #line hidden
            
            #line 386 "..\..\Template\Startup\OwinRouter.cshtml"
 Write(method.verifyCode);

            
            #line default
            #line hidden
            
            #line 386 "..\..\Template\Startup\OwinRouter.cshtml"
                        
						if(method.optimizing==0){

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t\t");

            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
          
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
     Write(fileData.appName);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                           
            
            #line default
            #line hidden
WriteLiteral(".Web.");

            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                   
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                              Write(config.defaultStyle);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                       
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                          
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                     Write(classData.relativeDotName);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                    
            
            #line default
            #line hidden
WriteLiteral(".");

            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                        
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                   Write(method.name);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                    
            
            #line default
            #line hidden
WriteLiteral("Action control= new ");

            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                           
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                      Write(fileData.appName);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                            
            
            #line default
            #line hidden
WriteLiteral(".Web.");

            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                    
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                               Write(config.defaultStyle);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                        
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                           
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                      Write(classData.relativeDotName);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                                                     
            
            #line default
            #line hidden
WriteLiteral(".");

            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                                                         
            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                                                    Write(method.name);

            
            #line default
            #line hidden
            
            #line 388 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                                                                                                     
            
            #line default
            #line hidden
WriteLiteral("Action(context);\r\n");

            
            #line 389 "..\..\Template\Startup\OwinRouter.cshtml"
						foreach(var parameterData in method.parameterDataList){

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t\t");

            
            #line 390 "..\..\Template\Startup\OwinRouter.cshtml"
   Write(parameterData.getParamterCode);

            
            #line default
            #line hidden
WriteLiteral("\r\n");

            
            #line 391 "..\..\Template\Startup\OwinRouter.cshtml"
						}

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._methodType = methodType;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._webContext = context;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._subdomain = subdomain;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._url=requestedPath;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._get = get;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._files = files;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control._app=\"/");

            
            #line 398 "..\..\Template\Startup\OwinRouter.cshtml"
                         
            
            #line default
            #line hidden
            
            #line 398 "..\..\Template\Startup\OwinRouter.cshtml"
                    Write(fileData.appName);

            
            #line default
            #line hidden
            
            #line 398 "..\..\Template\Startup\OwinRouter.cshtml"
                                          
            
            #line default
            #line hidden
WriteLiteral("\";\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control.Before();\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control.");

            
            #line 400 "..\..\Template\Startup\OwinRouter.cshtml"
                  
            
            #line default
            #line hidden
            
            #line 400 "..\..\Template\Startup\OwinRouter.cshtml"
             Write(method.name);

            
            #line default
            #line hidden
            
            #line 400 "..\..\Template\Startup\OwinRouter.cshtml"
                              
            
            #line default
            #line hidden
WriteLiteral("(");

            
            #line 400 "..\..\Template\Startup\OwinRouter.cshtml"
                                  
            
            #line default
            #line hidden
            
            #line 400 "..\..\Template\Startup\OwinRouter.cshtml"
                             Write(method.parameterNames);

            
            #line default
            #line hidden
            
            #line 400 "..\..\Template\Startup\OwinRouter.cshtml"
                                                        
            
            #line default
            #line hidden
WriteLiteral(");\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control.After();\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("control.Close();\r\n");

            
            #line 403 "..\..\Template\Startup\OwinRouter.cshtml"
						}
						else{
						//优化选项

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("int optimizing = ");

            
            #line 406 "..\..\Template\Startup\OwinRouter.cshtml"
                                             
            
            #line default
            #line hidden
            
            #line 406 "..\..\Template\Startup\OwinRouter.cshtml"
                                        Write(method.optimizing);

            
            #line default
            #line hidden
            
            #line 406 "..\..\Template\Startup\OwinRouter.cshtml"
                                                               
            
            #line default
            #line hidden
WriteLiteral(";\r\n");

WriteLiteral("                        ");

WriteLiteral("int minutes = ");

            
            #line 407 "..\..\Template\Startup\OwinRouter.cshtml"
                                          
            
            #line default
            #line hidden
            
            #line 407 "..\..\Template\Startup\OwinRouter.cshtml"
                                     Write(method.minutes);

            
            #line default
            #line hidden
            
            #line 407 "..\..\Template\Startup\OwinRouter.cshtml"
                                                         
            
            #line default
            #line hidden
WriteLiteral(";\r\n");

WriteLiteral("                        ");

WriteLiteral("string url = requestedPath;\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("string query=context.Request.QueryString.ToString();\r\n");

WriteLiteral("                        ");

WriteLiteral("bool compress = (optimizing & (int)NFinal.Optimizing.Comresssed)!=0;\r\n");

            
            #line 411 "..\..\Template\Startup\OwinRouter.cshtml"
                        //设置浏览器缓存

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("SetBrowerCache(context, optimizing, seconds);\r\n");

            
            #line 413 "..\..\Template\Startup\OwinRouter.cshtml"
                        //是否启用了服务器缓存

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("bool serverCahce = (optimizing & (int)NFinal.Optimizing.Cache_Server_Cached) != 0" +
";\r\n");

WriteLiteral("                        ");

WriteLiteral("bool hasCache = false;\r\n");

            
            #line 416 "..\..\Template\Startup\OwinRouter.cshtml"
                        //服务器缓存

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("if (serverCahce)\r\n");

WriteLiteral("                        ");

WriteLiteral("{\r\n");

            
            #line 419 "..\..\Template\Startup\OwinRouter.cshtml"
							//如果是文件缓存，不加query

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\tif ((optimizing & (int)NFinal.Optimizing.Cache_Server_FileDependency) != 0)\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\t{\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\t\thasCache=WriteCache(context,url,optimizing);\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\t}\r\n");

WriteLiteral("                        ");

WriteLiteral("  else\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\t{\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\t\thasCache=WriteCache(context,url+query,optimizing);\r\n");

WriteLiteral("\t\t\t\t\t\t");

WriteLiteral("\t}\r\n");

WriteLiteral("                        ");

WriteLiteral("}\r\n");

            
            #line 429 "..\..\Template\Startup\OwinRouter.cshtml"
                        //如果没有缓存

            
            #line default
            #line hidden
WriteLiteral("                        ");

WriteLiteral("if (!hasCache)\r\n");

WriteLiteral("                        ");

WriteLiteral("{\r\n");

WriteLiteral("                            ");

WriteLiteral("System.IO.MemoryStream htmlStream = new System.IO.MemoryStream();\r\n");

            
            #line 433 "..\..\Template\Startup\OwinRouter.cshtml"
                                    

            
            #line default
            #line hidden
WriteLiteral("                            ");

            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                
            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                           Write(fileData.appName);

            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                 
            
            #line default
            #line hidden
WriteLiteral(".Web.");

            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                         
            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                    Write(config.defaultStyle);

            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                             
            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                
            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                           Write(classData.relativeDotName);

            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                          
            
            #line default
            #line hidden
WriteLiteral(".");

            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                              
            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                         Write(method.name);

            
            #line default
            #line hidden
            
            #line 434 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                          
            
            #line default
            #line hidden
WriteLiteral("Action control = null;\r\n");

WriteLiteral("                            ");

WriteLiteral("System.IO.Stream stream = null;\r\n");

WriteLiteral("                            ");

WriteLiteral("System.IO.StreamWriter sw = null;\r\n");

            
            #line 437 "..\..\Template\Startup\OwinRouter.cshtml"
                            //如果有压缩或缓存

            
            #line default
            #line hidden
WriteLiteral("                            ");

WriteLiteral("if (compress || serverCahce)\r\n");

WriteLiteral("                            ");

WriteLiteral("{\r\n");

WriteLiteral("                            ");

WriteLiteral("    if ((optimizing & (int)NFinal.Optimizing.Comresssed) != 0)\r\n");

WriteLiteral("                            ");

WriteLiteral("    {\r\n");

WriteLiteral("                            ");

WriteLiteral("        if ((optimizing & (int)NFinal.Optimizing.CompressZip) != 0)\r\n");

WriteLiteral("                            ");

WriteLiteral("        {\r\n");

WriteLiteral("                            ");

WriteLiteral("            stream = new System.IO.Compression.GZipStream(htmlStream, System.IO.C" +
"ompression.CompressionMode.Compress, true);\r\n");

WriteLiteral("                            ");

WriteLiteral("            context.Response.Headers.Set(\"Content-Encoding\",\"gzip\");\r\n");

WriteLiteral("                            ");

WriteLiteral("        }\r\n");

WriteLiteral("                            ");

WriteLiteral("        else if ((optimizing & (int)NFinal.Optimizing.CompressDeflate) != 0)\r\n");

WriteLiteral("                            ");

WriteLiteral("        {\r\n");

WriteLiteral("                            ");

WriteLiteral("            stream = new System.IO.Compression.DeflateStream(htmlStream, System.I" +
"O.Compression.CompressionMode.Compress, true);\r\n");

WriteLiteral("                            ");

WriteLiteral("            context.Response.Headers.Set(\"Content-Encoding\", \"deflate\");\r\n");

WriteLiteral("                            ");

WriteLiteral("        }\r\n");

WriteLiteral("                            ");

WriteLiteral("        sw = new System.IO.StreamWriter(stream);\r\n");

WriteLiteral("                            ");

WriteLiteral("    }\r\n");

WriteLiteral("                            ");

WriteLiteral("    else\r\n");

WriteLiteral("                            ");

WriteLiteral("    {\r\n");

WriteLiteral("                            ");

WriteLiteral("        sw = new System.IO.StreamWriter(htmlStream);\r\n");

WriteLiteral("                            ");

WriteLiteral("    }\r\n");

WriteLiteral("                            ");

WriteLiteral("    control = new ${fileData.appName}.Web.");

            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                          
            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                     Write(config.defaultStyle);

            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                              
            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                 
            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                            Write(classData.relativeDotName);

            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                           
            
            #line default
            #line hidden
WriteLiteral(".");

            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                               
            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                          Write(method.name);

            
            #line default
            #line hidden
            
            #line 458 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                           
            
            #line default
            #line hidden
WriteLiteral("Action(sw);\r\n");

WriteLiteral("                            ");

WriteLiteral("}\r\n");

WriteLiteral("                            ");

WriteLiteral("else\r\n");

WriteLiteral("                            ");

WriteLiteral("{\r\n");

WriteLiteral("                            ");

WriteLiteral("    control = new ${fileData.appName}.Web.");

            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                          
            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                     Write(config.defaultStyle);

            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                              
            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                 
            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                            Write(classData.relativeDotName);

            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                           
            
            #line default
            #line hidden
WriteLiteral(".");

            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                               
            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                          Write(method.name);

            
            #line default
            #line hidden
            
            #line 462 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                                                                                           
            
            #line default
            #line hidden
WriteLiteral("Action(context);\r\n");

WriteLiteral("                            ");

WriteLiteral("}\r\n");

            
            #line 464 "..\..\Template\Startup\OwinRouter.cshtml"
							foreach(var parameterData in method.parameterDataList){
								
            
            #line default
            #line hidden
            
            #line 465 "..\..\Template\Startup\OwinRouter.cshtml"
   Write(parameterData.getParamterCode);

            
            #line default
            #line hidden
            
            #line 465 "..\..\Template\Startup\OwinRouter.cshtml"
                                      
							}

            
            #line default
            #line hidden
WriteLiteral("                            ");

WriteLiteral("control._webContext = context;\r\n");

WriteLiteral("                            ");

WriteLiteral("control._subdomain = subdomain;\r\n");

WriteLiteral("                            ");

WriteLiteral("control._url = requestedPath;\r\n");

WriteLiteral("                            ");

WriteLiteral("control._get = get;\r\n");

WriteLiteral("                            ");

WriteLiteral("control._app=\"/");

            
            #line 471 "..\..\Template\Startup\OwinRouter.cshtml"
                                               
            
            #line default
            #line hidden
            
            #line 471 "..\..\Template\Startup\OwinRouter.cshtml"
                                          Write(fileData.appName);

            
            #line default
            #line hidden
            
            #line 471 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                
            
            #line default
            #line hidden
WriteLiteral("\";\r\n");

WriteLiteral("                            ");

WriteLiteral("control.Before();\r\n");

WriteLiteral("                            ");

WriteLiteral("control.");

            
            #line 473 "..\..\Template\Startup\OwinRouter.cshtml"
                                        
            
            #line default
            #line hidden
            
            #line 473 "..\..\Template\Startup\OwinRouter.cshtml"
                                   Write(method.name);

            
            #line default
            #line hidden
            
            #line 473 "..\..\Template\Startup\OwinRouter.cshtml"
                                                    
            
            #line default
            #line hidden
WriteLiteral("(");

            
            #line 473 "..\..\Template\Startup\OwinRouter.cshtml"
                                                        
            
            #line default
            #line hidden
            
            #line 473 "..\..\Template\Startup\OwinRouter.cshtml"
                                                   Write(method.parameterNames);

            
            #line default
            #line hidden
            
            #line 473 "..\..\Template\Startup\OwinRouter.cshtml"
                                                                              
            
            #line default
            #line hidden
WriteLiteral(");\r\n");

WriteLiteral("                            ");

WriteLiteral("control.After();\r\n");

WriteLiteral("                            ");

WriteLiteral("control.Close();\r\n");

WriteLiteral("                            ");

WriteLiteral("byte[] buffer = htmlStream.ToArray();\r\n");

WriteLiteral("\t\t\t\t\t\t\t");

WriteLiteral("htmlStream.Dispose();\r\n");

            
            #line 478 "..\..\Template\Startup\OwinRouter.cshtml"
                            //如果有压缩或缓存

            
            #line default
            #line hidden
WriteLiteral("                            ");

WriteLiteral("if (compress || serverCahce)\r\n");

WriteLiteral("                            ");

WriteLiteral("{\r\n");

WriteLiteral("                            ");

WriteLiteral("    SetServerCacheAndOutPut(context, url, query, buffer, optimizing, minutes);\r\n");

WriteLiteral("                            ");

WriteLiteral("}\t\r\n");

            
            #line 483 "..\..\Template\Startup\OwinRouter.cshtml"
						}i++;
						}

            
            #line default
            #line hidden
WriteLiteral("\t\t\t\t\t");

WriteLiteral("}break;\r\n");

            
            #line 486 "..\..\Template\Startup\OwinRouter.cshtml"
				}
				}
				}
				
            
            #line default
            #line hidden
WriteLiteral("\r\n                default: break;\r\n            }\r\n        }\r\n    }\r\n#endif\r\n}");

        }
    }
}
#pragma warning restore 1591
